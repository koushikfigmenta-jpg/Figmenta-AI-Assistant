<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Figmenta Assistant</title>
  <style>
    :root{
      --bg:#f6f6f7;
      --card:#ffffff;
      --accent:#0f1724; /* deep slate */
      --muted:#6b7280;
      --brand:#1f6feb; /* primary brand color (adjust) */
      --bubble-bot:#f1f5f9;
      --bubble-user:#111827;
      --radius:14px;
      --shadow: 0 6px 18px rgba(16,24,40,0.06);
      --font-sans: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{height:100%;margin:0;background:linear-gradient(180deg,#fbfbfc 0%,#f6f7fb 100%);font-family:var(--font-sans);color:var(--accent);-webkit-font-smoothing:antialiased}
    .container{
      max-width:820px;margin:28px auto;padding:20px;
    }

    .card{
      background:var(--card);
      border-radius:18px;
      box-shadow:var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      height:76vh;
      min-height:560px;
    }

    .header{
      padding:18px 20px;border-bottom:1px solid #edf2f7;display:flex;align-items:center;gap:12px;
    }
    .logo{
      width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--brand),#5ec0ff);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:18px;
      box-shadow:0 4px 10px rgba(31,111,235,0.14);
    }
    .title{font-weight:700;font-size:16px}
    .subtitle{font-size:12px;color:var(--muted);margin-top:2px}

    .messages{
      flex:1; padding:18px; overflow:auto; background:linear-gradient(180deg, #fafbfd 0%, #ffffff 100%);
    }

    .message{max-width:74%;margin:10px 0;padding:12px 14px;border-radius:12px;line-height:1.38;font-size:14px;box-shadow:0 1px 0 rgba(16,24,40,0.02)}
    .bot{background:var(--bubble-bot); color:var(--accent); border-bottom-left-radius:6px}
    .user{background:var(--bubble-user); color:white;margin-left:auto;border-bottom-right-radius:6px;text-align:left}
    .meta{display:block;font-size:11px;color:var(--muted);margin-top:6px}

    .typing{opacity:0.85;font-style:italic}
    .typing .dot{display:inline-block;width:6px;height:6px;background:var(--muted);border-radius:50%;margin:0 3px;animation:blink 1s infinite}
    @keyframes blink{0%{opacity:0.2}50%{opacity:1}100%{opacity:0.2}}

    .input-area{
      padding:12px;border-top:1px solid #eef2f7;display:flex;gap:8px;align-items:center;
      background:linear-gradient(180deg,#fff,#fbfcff);
    }

    .input{
      flex:1;padding:12px 14px;border-radius:12px;border:1px solid #e6e9ef;background:transparent;font-size:14px;outline:none;
    }
    .btn{
      background:var(--brand);color:white;padding:10px 14px;border-radius:10px;border:none;font-weight:600;cursor:pointer;
      box-shadow: 0 6px 18px rgba(31,111,235,0.12);
    }
    .btn:disabled{opacity:0.6;cursor:not-allowed;box-shadow:none}

    .quick{
      padding:12px 18px;border-top:1px solid #f0f3f7;background:transparent;display:flex;gap:8px;flex-wrap:wrap;
    }
    .chip{background:#eef6ff;color:var(--brand);padding:8px 12px;border-radius:999px;font-size:13px;border:1px solid rgba(31,111,235,0.08);cursor:pointer}
    .chip:active{transform:translateY(1px)}

    /* small screens */
    @media (max-width:520px){
      .container{margin:10px}
      .card{height:82vh}
      .message{max-width:86%}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card" role="region" aria-label="Figmenta Assistant chat">
      <div class="header">
        <div class="logo">F</div>
        <div>
          <div class="title">Figmenta Assistant</div>
          <div class="subtitle">Figmenta Â· Elegant Digital Experiences</div>
        </div>
      </div>

      <div class="messages" id="messages" aria-live="polite">
        <div class="message bot" id="welcome">Welcome to Figmenta. How may I help you today?</div>
      </div>

      <div class="quick" id="quickReplies" aria-hidden="false">
        <div class="chip" data-text="I need a website">I need a website</div>
        <div class="chip" data-text="Pricing and timelines">Pricing & timelines</div>
        <div class="chip" data-text="Portfolio examples">Portfolio</div>
        <div class="chip" data-text="Careers">Careers</div>
      </div>

      <div class="input-area">
        <input id="input" class="input" type="text" placeholder="Ask about services or book an appointment..." aria-label="Message input" />
        <button id="sendBtn" class="btn" aria-label="Send message">Send</button>
      </div>
    </div>
  </div>

  <script>
    // CONFIGURE: replace with your n8n / server webhook
    const N8N_WEBHOOK_URL = "https://n8n.46.62.164.0.nip.io/webhook/FIGMENTA-ASSISTANT"; // ðŸ”´ REPLACE

    // Simple client-side conversation id (persist per session)
    const conversationId = sessionStorage.getItem('fig_convo_id') || ('fig_' + Math.random().toString(36).slice(2,12));
    sessionStorage.setItem('fig_convo_id', conversationId);

    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('sendBtn');
    const quickReplies = document.getElementById('quickReplies');

    // helper to append messages
    function appendMessage(text, who='bot', meta='') {
      const d = document.createElement('div');
      d.className = `message ${who}`;
      d.innerText = text;
      if (meta) {
        const m = document.createElement('span');
        m.className = 'meta';
        m.innerText = meta;
        d.appendChild(m);
      }
      messagesEl.appendChild(d);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    // typing indicator
    function showTyping() {
      removeTyping();
      const t = document.createElement('div');
      t.className = 'message bot typing';
      t.id = 'typing';
      t.innerHTML = 'Figmenta is typing <span class="dot"></span><span class="dot"></span><span class="dot"></span>';
      messagesEl.appendChild(t);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }
    function removeTyping() {
      const t = document.getElementById('typing');
      if (t) t.remove();
    }

    // throttle to prevent accidental double sends
    let awaiting = false;

    function sendPayload(text) {
      if (!N8N_WEBHOOK_URL || N8N_WEBHOOK_URL.includes('example.n8n')) {
        removeTyping();
        awaiting = false;
        appendMessage("Please configure the N8N_WEBHOOK_URL in the script to your workflow endpoint.", 'bot');
        return;
      }

      const payload = {
        brand: "Figmenta",
        channel: "web",
        conversation_id: conversationId,
        phone: 6290664570,
        message: text,
        timestamp: new Date().toISOString()
      };

      // call webhook
      return fetch(N8N_WEBHOOK_URL, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      })
      .then(async res => {
        if (!res.ok) {
          const t = await res.text();
          throw new Error('Request failed: ' + res.status + ' - ' + t);
        }
        return res.json();
      });
    }

    async function sendMessage(text) {
      if (awaiting) return;
      if (!text || !text.trim()) return;

      // show user message
      appendMessage(text, 'user');
      inputEl.value = '';
      inputEl.disabled = true;
      sendBtn.disabled = true;
      awaiting = true;

      // show typing
      showTyping();

      try {
        const data = await sendPayload(text);
        removeTyping();
        inputEl.disabled = false;
        sendBtn.disabled = false;
        awaiting = false;

        // expect backend to return { reply: "...", updated_memory: {...} }
        const reply = (data && data.reply) ? data.reply : (data.output?.assistant || "Sorry, I didn't understand that.");
        appendMessage(reply, 'bot');

        // optional: handle quick suggestions from backend
        if (data.quick && Array.isArray(data.quick)) {
          renderQuickReplies(data.quick);
        }
      } catch (err) {
        removeTyping();
        inputEl.disabled = false;
        sendBtn.disabled = false;
        awaiting = false;
        console.error(err);
        appendMessage("Sorry â€” something went wrong. Please try again in a moment.", 'bot');
      }
    }

    // quick reply click
    quickReplies.addEventListener('click', function(e){
      const chip = e.target.closest('.chip');
      if (!chip) return;
      const text = chip.getAttribute('data-text');
      if (!text) return;
      sendMessage(text);
    });

    // wire send button + enter key
    sendBtn.addEventListener('click', ()=> sendMessage(inputEl.value));
    inputEl.addEventListener('keydown', (e)=> {
      if (e.key === 'Enter') sendMessage(inputEl.value);
    });

    // render quick replies if backend provides
    function renderQuickReplies(items){
      quickReplies.innerHTML = '';
      items.forEach(i=>{
        const el = document.createElement('div');
        el.className = 'chip';
        el.setAttribute('data-text', i);
        el.innerText = i;
        quickReplies.appendChild(el);
      });
    }

    // initial focus
    window.addEventListener('load', ()=> inputEl.focus());
  </script>
</body>
</html>
