<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Figmenta Assistant</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #000000;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding:20px;
    }
    .container { max-width:500px; width:100%; }
    .card {
      background:#ffffff;
      border-radius:0;
      box-shadow:0 25px 80px rgba(0,0,0,0.15);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      max-height:90vh;
      border:1px solid #e5e5e5;
    }
    .header {
      background: #000000;
      color:#ffffff;
      padding:24px;
      display:flex;
      align-items:center;
      gap:16px;
      border-bottom:1px solid #1a1a1a;
    }
    .logo {
      width:44px; height:44px;
      background:#ffffff;
      color:#000000;
      border-radius:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      font-size:20px;
      letter-spacing:-0.5px;
    }
    .title { 
      font-size:16px; 
      font-weight:600; 
      letter-spacing:-0.3px;
    }
    .subtitle { 
      font-size:11px; 
      opacity:0.7; 
      margin-top:4px; 
      font-weight:400;
      letter-spacing:0.3px;
    }
    .messages {
      flex:1;
      overflow-y:auto;
      padding:24px;
      background:#fafafa;
    }
    .message {
      margin-bottom:16px;
      padding:14px 18px;
      border-radius:0;
      max-width:80%;
      animation: fadeIn 0.3s;
      line-height:1.5;
    }
    @keyframes fadeIn {
      from { opacity:0; transform:translateY(10px); }
      to { opacity:1; transform:translateY(0); }
    }
    .message.bot {
      background:#ffffff;
      color:#1a1a1a;
      margin-right:auto;
      border:1px solid #e5e5e5;
      font-size:14px;
    }
    .message.user {
      background: #000000;
      color:#ffffff;
      margin-left:auto;
      font-size:14px;
    }
    .message.typing {
      background:#ffffff;
      color:#666;
      border:1px solid #e5e5e5;
      font-style:normal;
      font-size:14px;
    }
    .dot {
      display:inline-block;
      width:5px; height:5px;
      background:#666;
      border-radius:50%;
      margin:0 2px;
      animation: bounce 1.4s infinite ease-in-out both;
    }
    .dot:nth-child(1) { animation-delay:-0.32s; }
    .dot:nth-child(2) { animation-delay:-0.16s; }
    @keyframes bounce {
      0%, 80%, 100% { transform:scale(0); }
      40% { transform:scale(1); }
    }
    .meta {
      display:block;
      font-size:11px;
      margin-top:6px;
      opacity:0.6;
    }
    .quick {
      padding:16px 24px;
      background:#ffffff;
      border-top:1px solid #e5e5e5;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .chip {
      background:#fafafa;
      border:1px solid #e5e5e5;
      padding:10px 18px;
      border-radius:0;
      font-size:13px;
      cursor:pointer;
      transition:all 0.2s;
      user-select:none;
      font-weight:500;
      letter-spacing:-0.2px;
    }
    .chip:hover {
      background: #000000;
      color:#ffffff;
      border-color:#000000;
    }
    .input-area {
      padding:20px 24px;
      background:#ffffff;
      border-top:1px solid #e5e5e5;
      display:flex;
      gap:12px;
    }
    .input {
      flex:1;
      border:1px solid #d4d4d4;
      border-radius:0;
      padding:12px 18px;
      font-size:14px;
      outline:none;
      transition:border 0.2s;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }
    .input:focus { 
      border-color:#000000; 
      box-shadow:0 0 0 1px #000000;
    }
    .btn {
      background: #000000;
      color:#ffffff;
      border:none;
      padding:12px 28px;
      border-radius:0;
      font-size:13px;
      font-weight:600;
      cursor:pointer;
      transition:all 0.2s;
      letter-spacing:0.3px;
      text-transform:uppercase;
    }
    .btn:hover {
      background:#1a1a1a;
      box-shadow:0 4px 16px rgba(0,0,0,0.2);
    }
    .btn:disabled {
      opacity:0.4;
      cursor:not-allowed;
      transform:none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card" role="region" aria-label="Figmenta Assistant chat">
      <div class="header">
        <div class="logo">F</div>
        <div>
          <div class="title">Figmenta Assistant</div>
          <div class="subtitle">Figmenta Â· Elegant Digital Experiences</div>
        </div>
      </div>
      <div class="messages" id="messages" aria-live="polite">
        <div class="message bot" id="welcome">Welcome to Figmenta. How may I help you today?</div>
      </div>
      <div class="quick" id="quickReplies" aria-hidden="false">
        <div class="chip" data-text="I need a website">I need a website</div>
        <div class="chip" data-text="Pricing and timelines">Pricing &amp; timelines</div>
        <div class="chip" data-text="Portfolio examples">Portfolio</div>
        <div class="chip" data-text="Careers">Careers</div>
      </div>
      <div class="input-area">
        <input id="input" class="input" type="text" placeholder="Ask about services or book an appointment..." aria-label="Message input">
        <button id="sendBtn" class="btn" aria-label="Send message">Send</button>
      </div>
    </div>
  </div>
  <script>
    // CONFIGURE: replace with your n8n / server webhook
    const N8N_WEBHOOK_URL = "https://n8n.46.62.164.0.nip.io/webhook/FIGMENTA-ASSISTANT"; // ðŸ”´ REPLACE
    // Simple client-side conversation id (persist per session)
    const conversationId = sessionStorage.getItem('fig_convo_id') || ('fig_' + Math.random().toString(36).slice(2,12));
    sessionStorage.setItem('fig_convo_id', conversationId);
    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('sendBtn');
    const quickReplies = document.getElementById('quickReplies');
    // helper to append messages
    function appendMessage(text, who='bot', meta='') {
      const d = document.createElement('div');
      d.className = `message ${who}`;
      d.innerText = text;
      if (meta) {
        const m = document.createElement('span');
        m.className = 'meta';
        m.innerText = meta;
        d.appendChild(m);
      }
      messagesEl.appendChild(d);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }
    // typing indicator
    function showTyping() {
      removeTyping();
      const t = document.createElement('div');
      t.className = 'message bot typing';
      t.id = 'typing';
      t.innerHTML = 'Figmenta is typing <span class="dot"></span><span class="dot"></span><span class="dot"></span>';
      messagesEl.appendChild(t);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }
    function removeTyping() {
      const t = document.getElementById('typing');
      if (t) t.remove();
    }
    // throttle to prevent accidental double sends
    let awaiting = false;
    function sendPayload(text) {
      if (!N8N_WEBHOOK_URL || N8N_WEBHOOK_URL.includes('example.n8n')) {
        removeTyping();
        awaiting = false;
        appendMessage("Please configure the N8N_WEBHOOK_URL in the script to your workflow endpoint.", 'bot');
        return;
      }
      const payload = {
        brand: "Figmenta",
        channel: "web",
        conversation_id: conversationId,
        phone: 6290664570,
        message: text,
        timestamp: new Date().toISOString()
      };
      // call webhook
      return fetch(N8N_WEBHOOK_URL, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      })
      .then(async res => {
        if (!res.ok) {
          const t = await res.text();
          throw new Error('Request failed: ' + res.status + ' - ' + t);
        }
        return res.json();
      });
    }
    async function sendMessage(text) {
      if (awaiting) return;
      if (!text || !text.trim()) return;
      // show user message
      appendMessage(text, 'user');
      inputEl.value = '';
      inputEl.disabled = true;
      sendBtn.disabled = true;
      awaiting = true;
      // show typing
      showTyping();
      try {
        const data = await sendPayload(text);
        removeTyping();
        inputEl.disabled = false;
        sendBtn.disabled = false;
        awaiting = false;
        // expect backend to return { reply: "...", updated_memory: {...} }
        const reply = (data && data.reply) ? data.reply : (data.output?.assistant || "Sorry, I didn't understand that.");
        appendMessage(reply, 'bot');
        // optional: handle quick suggestions from backend
        if (data.quick && Array.isArray(data.quick)) {
          renderQuickReplies(data.quick);
        }
      } catch (err) {
        removeTyping();
        inputEl.disabled = false;
        sendBtn.disabled = false;
        awaiting = false;
        console.error(err);
        appendMessage("Sorry â€” something went wrong. Please try again in a moment.", 'bot');
      }
    }
    // quick reply click
    quickReplies.addEventListener('click', function(e){
      const chip = e.target.closest('.chip');
      if (!chip) return;
      const text = chip.getAttribute('data-text');
      if (!text) return;
      sendMessage(text);
    });
    // wire send button + enter key
    sendBtn.addEventListener('click', ()=> sendMessage(inputEl.value));
    inputEl.addEventListener('keydown', (e)=> {
      if (e.key === 'Enter') sendMessage(inputEl.value);
    });
    // render quick replies if backend provides
    function renderQuickReplies(items){
      quickReplies.innerHTML = '';
      items.forEach(i=>{
        const el = document.createElement('div');
        el.className = 'chip';
        el.setAttribute('data-text', i);
        el.innerText = i;
        quickReplies.appendChild(el);
      });
    }
    // initial focus
    window.addEventListener('load', ()=> inputEl.focus());
  </script>
</body>
</html>
