<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Figmenta Assistant</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        /* Figmenta Brand Theme - Luxurious, Minimalist for Beauty/Fashion/Luxury */
        :root {
            --primary-navy: #0A2540; /* Deep navy for headers, accents */
            --gold-accent: #D4AF37; /* Gold for highlights, buttons */
            --bg-cream: #F9F9F5; /* Soft cream background */
            --text-dark: #1A1A1A; /* Dark gray for primary text */
            --text-light: #FFFFFF; /* White for overlays */
            --border-light: #E5E5E5; /* Subtle borders */
            --shadow-elegant: 0 8px 32px rgba(10, 37, 64, 0.1); /* Soft, luxurious shadow */
            --border-radius: 12px; /* Gentle curves */
            --font-heading: 'Playfair Display', serif; /* Elegant serif for titles */
            --font-body: 'Inter', -apple-system, sans-serif; /* Clean sans for body */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); /* Smooth animations */
        }

        body {
            font-family: var(--font-body);
            background-color: var(--bg-cream);
            color: var(--text-dark);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        @media (max-width: 768px) {
            .container {
                width: 90%;
                right: 5%;
                left: 5%;
            }
        }

        .card {
            background: var(--text-light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-elegant);
            overflow: hidden;
            border: 1px solid var(--border-light);
            display: flex;
            flex-direction: column;
            height: 600px; /* Fixed height for consistency; adjust if needed */
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: 0 12px 40px rgba(10, 37, 64, 0.15);
        }

        .header {
            background: linear-gradient(135deg, var(--primary-navy) 0%, #1E3A5F 100%);
            color: var(--text-light);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-radius: var(--border-radius) var(--border-radius) 0 0;
        }

        .logo {
            width: 32px;
            height: 32px;
            background: var(--gold-accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-heading);
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-navy);
            flex-shrink: 0;
        }

        .title {
            font-family: var(--font-heading);
            font-size: 20px;
            font-weight: 700;
            margin: 0;
        }

        .subtitle {
            font-size: 12px;
            opacity: 0.9;
            margin: 0;
            font-weight: 300;
        }

        .messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: var(--bg-cream);
            scroll-behavior: smooth;
        }

        .messages::-webkit-scrollbar {
            width: 4px;
        }

        .messages::-webkit-scrollbar-track {
            background: var(--border-light);
        }

        .messages::-webkit-scrollbar-thumb {
            background: var(--primary-navy);
            border-radius: 2px;
        }

        .message {
            margin-bottom: 16px;
            padding: 12px 16px;
            border-radius: var(--border-radius);
            max-width: 85%;
            position: relative;
            word-wrap: break-word;
            font-size: 14px;
            line-height: 1.5;
            transition: var(--transition);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .message.bot {
            background: var(--primary-navy);
            color: var(--text-light);
            align-self: flex-start;
            margin-left: 0;
            border-bottom-left-radius: 4px;
        }

        .message.user {
            background: var(--gold-accent);
            color: var(--text-dark);
            align-self: flex-end;
            margin-right: 0;
            border-bottom-right-radius: 4px;
        }

        .message.typing {
            background: transparent;
            color: var(--primary-navy);
            font-style: italic;
            box-shadow: none;
        }

        .dot {
            display: inline-block;
            width: 4px;
            height: 4px;
            background: var(--gold-accent);
            border-radius: 50%;
            margin: 0 2px;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .quick {
            padding: 12px 20px;
            background: var(--text-light);
            border-top: 1px solid var(--border-light);
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            max-height: 80px;
            overflow-y: auto;
        }

        .chip {
            background: var(--bg-cream);
            color: var(--text-dark);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            cursor: pointer;
            border: 1px solid var(--border-light);
            transition: var(--transition);
            user-select: none;
        }

        .chip:hover {
            background: var(--primary-navy);
            color: var(--text-light);
            border-color: var(--primary-navy);
            transform: translateY(-1px);
        }

        .input-area {
            padding: 20px;
            background: var(--text-light);
            border-top: 1px solid var(--border-light);
            display: flex;
            gap: 12px;
        }

        .input {
            flex: 1;
            border: 1px solid var(--border-light);
            border-radius: 24px;
            padding: 12px 20px;
            font-family: var(--font-body);
            font-size: 14px;
            outline: none;
            transition: var(--transition);
            background: var(--bg-cream);
        }

        .input:focus {
            border-color: var(--gold-accent);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .input::placeholder {
            color: #A0A0A0;
            opacity: 1;
        }

        .btn {
            background: var(--primary-navy);
            color: var(--text-light);
            border: none;
            border-radius: 24px;
            padding: 12px 20px;
            cursor: pointer;
            font-family: var(--font-body);
            font-weight: 500;
            font-size: 14px;
            min-width: 80px;
            transition: var(--transition);
            flex-shrink: 0;
        }

        .btn:hover:not(:disabled) {
            background: var(--gold-accent);
            color: var(--primary-navy);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Accessibility enhancements */
        [role="region"] {
            outline: none;
        }

        [aria-live="polite"] .message:last-child {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Hide quick replies if aria-hidden=true */
        [aria-hidden="true"] {
            display: none;
        }
    </style>
</head>
<body>
  <div class="container">
    <div class="card figmenta-theme" role="region" aria-label="Figmenta Assistant chat">
      <div class="header">
        <div class="logo">F</div>
        <div>
          <div class="title">Figmenta Assistant</div>
          <div class="subtitle">Figmenta Â· Elegant Digital Experiences</div>
        </div>
      </div>
      <div class="messages" id="messages" aria-live="polite">
        <div class="message bot" id="welcome">Welcome to Figmenta. How may I help you today?</div>
      <div class="message user">I need a website</div><div class="message bot">Sorry â€” something went wrong. Please try again in a moment.</div><div class="message user">Careers</div><div class="message bot">You can find our current job openings and application details on our careers page: https://figmenta.com/en/careers.</div><div class="message user">Portfolio examples</div><div class="message bot">You can find information on our current vacancies and how to apply on our careers page: https://figmenta.com/en/careers.</div><div class="message user">Pricing and timelines</div><div class="message bot">{{ $json.output }}</div><div class="message user">Pricing and timelines</div><div class="message bot">{{$json.output.follow_up_question }}</div><div class="message user">Pricing and timelines</div><div class="message bot">{{$json.follow_up_question }}</div><div class="message user">Pricing and timelines</div><div class="message bot">{{$json.follow_up_question }}</div><div class="message user">Careers</div><div class="message bot">You can find our current job openings and application details on our careers page: https://figmenta.com/en/careers.</div><div class="message user">Portfolio examples</div><div class="message bot">Sorry â€” something went wrong. Please try again in a moment.</div><div class="message user">Portfolio examples</div><div class="message bot">{{$json.output.follow_up_question }}</div><div class="message user">Pricing and timelines</div><div class="message bot">{{$json.output.follow_up_question }}</div><div class="message user">Pricing and timelines</div><div class="message bot">Happy to help with more specific details about pricing and timelines. Could you please share your email address so I can send you more information?</div><div class="message user">Pricing and timelines</div><div class="message bot">Sorry â€” something went wrong. Please try again in a moment.</div><div class="message user">Pricing and timelines</div><div class="message bot">Sorry â€” something went wrong. Please try again in a moment.</div><div class="message user">Pricing and timelines</div><div class="message bot">Could you please share your email address so I can send you more detailed information about pricing and timelines?</div><div class="message user">Portfolio examples</div><div class="message bot">Happy to help. Could you share your email so I can send more details about our portfolio and services?</div><div class="message user">Careers</div><div class="message bot">You can find all the information about available positions and how to apply on our official careers page: https://figmenta.com/en/careers</div><div class="message user">I need a website</div><div class="message bot">Could you please share your email address so I can assist you further with your website needs?</div><div class="message user">Portfolio examples</div><div class="message bot">What kind of projects are you interested in? We have a variety of examples, from digital communication strategies to content creation and community engagement.</div><div class="message user">for my ecommerce brand</div><div class="message bot">That sounds like an exciting project! What's the main goal you're trying to achieve with your ecommerce website?</div><div class="message user">redesign it</div><div class="message bot">What's the main reason you're looking to redesign your ecommerce website? Is there something specific you're trying to achieve or improve?</div><div class="message user">speed seo overal look</div><div class="message bot">That sounds like a great goal! By the way, what's a good name to call you?</div><div class="message user">Koushik Biswas</div><div class="message bot">Sorry â€” something went wrong. Please try again in a moment.</div><div class="message user">Careers</div><div class="message bot">Sorry â€” something went wrong. Please try again in a moment.</div><div class="message user">Careers</div><div class="message bot">Visit https://figmenta.com/en/careers for job openings.</div><div class="message user">I need a website</div><div class="message bot">Sorry â€” something went wrong. Please try again in a moment.</div><div class="message user">i wants to talk to human</div><div class="message bot">I'm here to help briefly, what's on your mind?</div><div class="message user">wants a website its urgent </div><div class="message bot">Thank you! Our team will reach out first thing tomorrow during office hours.</div><div class="message user">I need a website</div><div class="message bot">That sounds like an exciting project! What's the main goal you're trying to achieve with your website?</div><div class="message user">what is figmernta</div><div class="message bot">Figmenta is a company, but I'd be happy to help with a specific question or direct you to our services if you're interested.</div><div class="message user">yes i am interested but before that i wants to know anbout you </div><div class="message bot">Figmenta is a creative agency specializing in branding, marketing, and digital experiences. We believe in innovation and creativity. What kind of project are you thinking of, and how can we assist you?</div><div class="message user">i want complete digital presence liuke website seo markeitng content creation edtc so what are the services you provide tell me briefly </div><div class="message bot">Figmenta provides services such as branding, marketing, and digital experiences. We can help you with website development, SEO, content creation, and more. To get started, could you please share your email so we can discuss further?</div><div class="message user">i want ba websdite seo ndigital presences and many more so tell me first you services briuefly bspo i can understand if i can ge</div><div class="message bot">That sounds great! To get started, could you please share your email so we can discuss further?</div></div>
      <div class="quick" id="quickReplies" aria-hidden="false">
        <div class="chip" data-text="I need a website">I need a website</div>
        <div class="chip" data-text="Pricing and timelines">Pricing &amp; timelines</div>
        <div class="chip" data-text="Portfolio examples">Portfolio</div>
        <div class="chip" data-text="Careers">Careers</div>
      </div>
      <div class="input-area">
        <input id="input" class="input" type="text" placeholder="Ask about services or book an appointment..." aria-label="Message input">
        <button id="sendBtn" class="btn" aria-label="Send message">Send</button>
      </div>
    </div>
  </div>
  <script>
    // CONFIGURE: replace with your n8n / server webhook
    const N8N_WEBHOOK_URL = "https://n8n.46.62.164.0.nip.io/webhook/FIGMENTA-ASSISTANT"; // ðŸ”´ REPLACE
    // Simple client-side conversation id (persist per session)
    const conversationId = sessionStorage.getItem('fig_convo_id') || ('fig_' + Math.random().toString(36).slice(2,12));
    sessionStorage.setItem('fig_convo_id', conversationId);
    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('sendBtn');
    const quickReplies = document.getElementById('quickReplies');
    // helper to append messages
    function appendMessage(text, who='bot', meta='') {
      const d = document.createElement('div');
      d.className = `message ${who}`;
      d.innerText = text;
      if (meta) {
        const m = document.createElement('span');
        m.className = 'meta';
        m.innerText = meta;
        d.appendChild(m);
      }
      messagesEl.appendChild(d);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }
    // typing indicator
    function showTyping() {
      removeTyping();
      const t = document.createElement('div');
      t.className = 'message bot typing';
      t.id = 'typing';
      t.innerHTML = 'Figmenta is typing <span class="dot"></span><span class="dot"></span><span class="dot"></span>';
      messagesEl.appendChild(t);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }
    function removeTyping() {
      const t = document.getElementById('typing');
      if (t) t.remove();
    }
    // throttle to prevent accidental double sends
    let awaiting = false;
    function sendPayload(text) {
      if (!N8N_WEBHOOK_URL || N8N_WEBHOOK_URL.includes('example.n8n')) {
        removeTyping();
        awaiting = false;
        appendMessage("Please configure the N8N_WEBHOOK_URL in the script to your workflow endpoint.", 'bot');
        return;
      }
      const payload = {
        brand: "Figmenta",
        channel: "web",
        conversation_id: conversationId,
        phone: 6290664570,
        message: text,
        timestamp: new Date().toISOString()
      };
      // call webhook
      return fetch(N8N_WEBHOOK_URL, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      })
      .then(async res => {
        if (!res.ok) {
          const t = await res.text();
          throw new Error('Request failed: ' + res.status + ' - ' + t);
        }
        return res.json();
      });
    }
    async function sendMessage(text) {
      if (awaiting) return;
      if (!text || !text.trim()) return;
      // show user message
      appendMessage(text, 'user');
      inputEl.value = '';
      inputEl.disabled = true;
      sendBtn.disabled = true;
      awaiting = true;
      // show typing
      showTyping();
      try {
        const data = await sendPayload(text);
        removeTyping();
        inputEl.disabled = false;
        sendBtn.disabled = false;
        awaiting = false;
        // expect backend to return { reply: "...", updated_memory: {...} }
        const reply = (data && data.reply) ? data.reply : (data.output?.assistant || "Sorry, I didn't understand that.");
        appendMessage(reply, 'bot');
        // optional: handle quick suggestions from backend
        if (data.quick && Array.isArray(data.quick)) {
          renderQuickReplies(data.quick);
        }
      } catch (err) {
        removeTyping();
        inputEl.disabled = false;
        sendBtn.disabled = false;
        awaiting = false;
        console.error(err);
        appendMessage("Sorry â€” something went wrong. Please try again in a moment.", 'bot');
      }
    }
    // quick reply click
    quickReplies.addEventListener('click', function(e){
      const chip = e.target.closest('.chip');
      if (!chip) return;
      const text = chip.getAttribute('data-text');
      if (!text) return;
      sendMessage(text);
    });
    // wire send button + enter key
    sendBtn.addEventListener('click', ()=> sendMessage(inputEl.value));
    inputEl.addEventListener('keydown', (e)=> {
      if (e.key === 'Enter') sendMessage(inputEl.value);
    });
    // render quick replies if backend provides
    function renderQuickReplies(items){
      quickReplies.innerHTML = '';
      items.forEach(i=>{
        const el = document.createElement('div');
        el.className = 'chip';
        el.setAttribute('data-text', i);
        el.innerText = i;
        quickReplies.appendChild(el);
      });
    }
    // initial focus
    window.addEventListener('load', ()=> inputEl.focus());
  </script>
</body>
</html>
